v {xschem version=3.4.5 file_version=1.2
}
G {}
K {}
V {}
S {}
E {}
N -1420 -725 -1170 -725 { lab=Va}
N -1040 -725 -940 -725 { lab=Vb}
N -940 -725 -810 -725 { lab=Vb}
N -1160 -435 -1160 -405 { lab=GND}
N -1160 -405 -1060 -405 { lab=GND}
N -1350 -405 -1160 -405 { lab=GND}
N -1220 -465 -1160 -465 { lab=GND}
N -1220 -465 -1220 -405 { lab=GND}
N -1100 -725 -1090 -725 { lab=Va}
N -1230 -1065 -1010 -1065 { lab=VDD}
N -1010 -1065 -750 -1065 { lab=VDD}
N -940 -725 -940 -705 { lab=Vb}
N -940 -805 -940 -725 { lab=Vb}
N -430 -855 -430 -825 { lab=vbg}
N -430 -825 -430 -725 { lab=vbg}
N -940 -645 -940 -625 { lab=#net1}
N -810 -725 -810 -705 { lab=Vb}
N -810 -645 -810 -625 { lab=#net2}
N -1420 -725 -1420 -705 { lab=Va}
N -1420 -645 -1420 -625 { lab=#net3}
N -940 -935 -940 -865 { lab=#net4}
N -940 -565 -940 -545 { lab=vbneg}
N -940 -545 -940 -505 { lab=vbneg}
N -940 -505 -940 -495 { lab=vbneg}
N -1060 -405 -940 -405 { lab=GND}
N -1420 -565 -1420 -405 { lab=GND}
N -810 -565 -810 -405 { lab=GND}
N -430 -665 -430 -405 { lab=GND}
N -1010 -405 -750 -405 { lab=GND}
N -900 -465 -900 -405 { lab=GND}
N -1160 -725 -1160 -705 { lab=Va}
N -940 -435 -940 -405 { lab=GND}
N -980 -465 -940 -465 { lab=GND}
N -980 -465 -980 -405 { lab=GND}
N -1120 -465 -1100 -465 { lab=GND}
N -1100 -465 -1100 -405 { lab=GND}
N -1440 -595 -1440 -545 { lab=GND}
N -1440 -545 -1420 -545 { lab=GND}
N -830 -595 -830 -535 { lab=GND}
N -830 -535 -810 -535 { lab=GND}
N -1040 -595 -960 -595 { lab=GND}
N -1040 -595 -1040 -405 { lab=GND}
N -450 -695 -450 -645 { lab=GND}
N -450 -645 -430 -645 { lab=GND}
N -1160 -645 -1160 -495 { lab=Veb}
N -940 -1005 -940 -995 { lab=VDD}
N -430 -925 -430 -915 { lab=#net5}
N -1160 -815 -1160 -715 { lab=Va}
N -1050 -725 -1040 -725 { lab=Vb}
N -1160 -935 -1160 -875 { lab=#net6}
N -940 -995 -940 -965 { lab=VDD}
N -1200 -975 -1200 -965 { lab=vgate}
N -1160 -995 -1160 -965 { lab=VDD}
N -1640 -1005 -1580 -1005 { lab=vg}
N -1580 -1035 -1580 -1005 { lab=vg}
N -1600 -1035 -1580 -1035 { lab=vg}
N -1580 -1035 -1470 -1035 { lab=vg}
N -1640 -1085 -1640 -1065 { lab=VDD}
N -1640 -1085 -1430 -1085 { lab=VDD}
N -1430 -1085 -1430 -1065 { lab=VDD}
N -1640 -1005 -1640 -935 { lab=vg}
N -1430 -1005 -1430 -935 { lab=vgate}
N -1390 -905 -1370 -905 { lab=Va}
N -1700 -905 -1680 -905 { lab=Vb}
N -1640 -875 -1430 -875 { lab=Vq}
N -1430 -1035 -1420 -1035 { lab=VDD}
N -1420 -1065 -1420 -1035 { lab=VDD}
N -1430 -1065 -1420 -1065 { lab=VDD}
N -1650 -1035 -1640 -1035 { lab=VDD}
N -1650 -1065 -1650 -1035 { lab=VDD}
N -1650 -1065 -1640 -1065 { lab=VDD}
N -1640 -905 -1630 -905 { lab=Vq}
N -1630 -905 -1630 -875 { lab=Vq}
N -1440 -905 -1430 -905 { lab=Vq}
N -1440 -905 -1440 -875 { lab=Vq}
N -1540 -795 -1530 -795 { lab=GND}
N -1540 -795 -1540 -765 { lab=GND}
N -1540 -765 -1530 -765 { lab=GND}
N -1530 -875 -1530 -825 { lab=Vq}
N -1490 -795 -1360 -795 { lab=Vx}
N -1320 -795 -1310 -795 { lab=GND}
N -1320 -935 -1320 -825 { lab=Vx}
N -1320 -1065 -1270 -1065 { lab=VDD}
N -1460 -765 -1320 -765 { lab=GND}
N -1530 -765 -1460 -765 { lab=GND}
N -1360 -825 -1360 -795 { lab=Vx}
N -1360 -825 -1320 -825 { lab=Vx}
N -1320 -1065 -1320 -995 { lab=VDD}
N -1270 -1065 -1230 -1065 { lab=VDD}
N -1200 -965 -1200 -955 { lab=vgate}
N -1430 -955 -1270 -955 { lab=vgate}
N -1310 -795 -1310 -765 { lab=GND}
N -1320 -765 -1310 -765 { lab=GND}
N -1360 -965 -1360 -955 { lab=vgate}
N -1320 -965 -1310 -965 { lab=VDD}
N -1310 -995 -1310 -965 { lab=VDD}
N -1320 -995 -1310 -995 { lab=VDD}
N -550 -1065 -550 -965 { lab=VDD}
N -510 -935 -510 -855 { lab=vgate}
N -560 -935 -550 -935 { lab=VDD}
N -560 -965 -560 -935 { lab=VDD}
N -560 -965 -550 -965 { lab=VDD}
N -550 -905 -550 -885 { lab=vinv}
N -560 -855 -550 -855 { lab=GND}
N -560 -855 -560 -825 { lab=GND}
N -560 -825 -550 -825 { lab=GND}
N -550 -825 -550 -405 { lab=GND}
N -510 -895 -500 -895 { lab=vgate}
N -500 -975 -500 -895 { lab=vgate}
N -740 -1065 -740 -805 { lab=VDD}
N -750 -775 -740 -775 { lab=VDD}
N -750 -805 -750 -775 { lab=VDD}
N -580 -895 -580 -775 { lab=vinv}
N -580 -895 -550 -895 { lab=vinv}
N -750 -1065 -460 -1065 { lab=VDD}
N -750 -405 -460 -405 { lab=GND}
N -1290 -745 -740 -745 { lab=Vx}
N -1290 -825 -1290 -745 { lab=Vx}
N -1320 -825 -1290 -825 { lab=Vx}
N -760 -975 -470 -975 { lab=vgate}
N -1170 -725 -1100 -725 { lab=Va}
N -1420 -405 -1350 -405 { lab=GND}
N -1160 -1065 -1160 -995 { lab=VDD}
N -940 -1065 -940 -1005 { lab=VDD}
N -1270 -955 -1200 -955 { lab=vgate}
N -1200 -975 -1010 -975 { lab=vgate}
N -1010 -975 -760 -975 { lab=vgate}
N -980 -975 -980 -965 { lab=vgate}
N -750 -805 -740 -805 { lab=VDD}
N -460 -1065 -430 -1065 { lab=VDD}
N -700 -775 -580 -775 { lab=vinv}
N -460 -405 -430 -405 { lab=GND}
N -430 -945 -430 -925 { lab=#net5}
N -430 -975 -420 -975 { lab=VDD}
N -420 -1005 -420 -975 { lab=VDD}
N -430 -1005 -420 -1005 { lab=VDD}
N -430 -1065 -430 -1005 { lab=VDD}
N -1160 -965 -1160 -955 { lab=VDD}
C {devices/vsource.sym} -1870 -1085 0 0 {name=V1 net_name=true value=1.8}
C {devices/vdd.sym} -1870 -1115 0 0 {name=l8 lab=VDD}
C {devices/gnd.sym} -1870 -1055 0 0 {name=l9 lab=GND}
C {devices/code_shown.sym} -2420 -1245 0 0 {name=NGSPICE
only_toplevel=true
spice_ignore=true
value="
.option savecurrents
.option warn=1
.param R3val='800k'
.param alpha='1'
.param R2R3ratio='5.8366561*alpha'
.param R2val='R3val*R2R3ratio' 
.param R4R2ratio=0.47810041
.param R4val='R2val*R4R2ratio'
.control
save all
dc TEMP -40 140 1
plot Vbg
plot deriv(Vbg)
let i = vm3#branch
let indx = 67
*indx is the index of temperature sweep for 27degC
echo 'Vbg @ 27degC'
let vbg27c = vbg[indx]
print vbg27c
echo 'dVbe/degC & ppm @ 27degC'
print deriv(vbg)[indx] deriv(vbg)[indx]/vbg27c
echo 'ppm real'
print (vbg[110]-vbg[40])/vbg[67]/(70-0)*1e6
plot deriv(vbg)/vbg27c
plot v(va, vb) vs i
plot vm1#branch vm2#branch vm3#branch
let vsg = vdd - vgate
let vsd1 = vdd - va
let vsd2 = vdd - vb
let vsd3 = vdd - vbg
let vthp = @m.xm1.msky130_fd_pr__pfet_01v8_lvt['vth']
let vov = vsg - vthp
plot vov vsd1 vsd2 vsd3
let deltav = vb - vbneg
let r4 =vbg/vm3#branch
let r1 =va/vr1#branch
let r2 =vb/vr4#branch
let r3 =deltav/vr2#branch
let vptat =(r2/r3*deltav)
let sum = veb+vptat
plot veb vptat sum
plot deriv(veb) deriv(vptat)
let TCratio=deriv(veb)/deriv(vptat)
plot TCratio
plot vb - va
echo 'alpha correction factor'
let alpha=TCratio[indx]
print alpha
let gm1=@m.xm1.msky130_fd_pr__pfet_01v8_lvt[gm]
let gm2=@m.xm2.msky130_fd_pr__pfet_01v8_lvt[gm]
let Av2=gm2 * ((r3 + r3/ln(39)) * r2 / (r3 + r3/ln(39) + r2) )
let Av1=gm1 * (r1 * r3/ln(39))/(r1 + r3/ln(39))
plot Av1 Av2 Av2/Av1
*write tsmc_bandgap_temp.raw
*op
*write tsmc_bandgap_op.raw
*print vbg 
*print (vb - vbneg)
.endc
" }
C {sky130_fd_pr/pnp_05v5.sym} -1140 -465 0 1 {name=Q2
model=pnp_05v5_W3p40L3p40
spiceprefix=X
}
C {devices/gnd.sym} -1130 -405 0 0 {name=l1 lab=GND}
C {devices/lab_pin.sym} -1090 -725 3 0 {name=l5 lab=Va}
C {devices/lab_pin.sym} -1050 -725 3 0 {name=l6 lab=Vb}
C {devices/vdd.sym} -1010 -1065 0 0 {name=l7 lab=VDD}
C {devices/ammeter.sym} -810 -675 0 0 {name=Vr4}
C {devices/ammeter.sym} -940 -675 0 0 {name=Vr2}
C {devices/ammeter.sym} -1160 -845 0 0 {name=Vm1}
C {devices/ammeter.sym} -940 -835 0 0 {name=Vm2}
C {devices/ammeter.sym} -430 -885 0 0 {name=Vm3}
C {devices/ammeter.sym} -1420 -675 0 0 {name=Vr1}
C {devices/ammeter.sym} -1160 -675 0 0 {name=Vq2}
C {sky130_fd_pr/pnp_05v5.sym} -920 -465 0 1 {name=Q1
model="pnp_05v5_W3p40L3p40 m=39"
spiceprefix=X
}
C {devices/lab_pin.sym} -940 -535 0 0 {name=l4 lab=vbneg}
C {devices/lab_pin.sym} -1160 -615 2 0 {name=l10 lab=Veb}
C {devices/lab_wire.sym} -1010 -975 0 0 {name=l11 lab=vgate}
C {devices/vdd.sym} -1520 -1085 0 0 {name=l14 lab=VDD}
C {devices/lab_pin.sym} -1700 -905 3 0 {name=l15 lab=Vb}
C {devices/lab_pin.sym} -1370 -905 3 0 {name=l16 lab=Va}
C {devices/gnd.sym} -1460 -765 0 0 {name=l17 lab=GND}
C {sky130_fd_pr/pfet_01v8_lvt.sym} -1450 -1035 0 0 {name=M4
L='0.35*4'
W='7.0*4'
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8_lvt
spiceprefix=X
}
C {sky130_fd_pr/nfet_01v8_lvt.sym} -1410 -905 0 1 {name=M5
L='1*4'
W='15*4'
nf=1
mult=4
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8_lvt
spiceprefix=X
}
C {sky130_fd_pr/nfet_01v8_lvt.sym} -1510 -795 0 1 {name=M6
L=2.55
W=16
nf=1
mult=16
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8_lvt
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8_lvt.sym} -1620 -1035 0 1 {name=M8
L='0.35*4'
W='7.0*4'
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8_lvt
spiceprefix=X
}
C {sky130_fd_pr/nfet_01v8_lvt.sym} -1660 -905 0 0 {name=M9
L='1*4'
W='15*4'
nf=1
mult=4
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8_lvt
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8_lvt.sym} -530 -935 0 1 {name=M10
L=0.35
W='1'
nf=1
mult=50
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8_lvt
spiceprefix=X
}
C {sky130_fd_pr/nfet_01v8_lvt.sym} -530 -855 0 1 {name=M11
L=8
W=1
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8_lvt
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8_lvt.sym} -720 -775 0 1 {name=M12
L=0.35
W=1
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8_lvt
spiceprefix=X
}
C {devices/lab_pin.sym} -1520 -1035 1 0 {name=l2 lab=vg}
C {devices/lab_pin.sym} -1290 -825 1 0 {name=l12 lab=Vx}
C {devices/lab_pin.sym} -570 -895 0 0 {name=l13 lab=vinv}
C {devices/lab_pin.sym} -1530 -855 0 0 {name=l18 lab=Vq}
C {sky130_fd_pr/nfet_01v8_lvt.sym} -1340 -795 0 0 {name=M7
L=2.55
W=16
nf=1
mult=16
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8_lvt
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8_lvt.sym} -1340 -965 0 0 {name=M13
L=0.35
W='1.143308'
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8_lvt
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8_lvt.sym} -1180 -955 0 0 {name=M1
L=0.35
W='1.143308'
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8_lvt
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8_lvt.sym} -960 -965 0 0 {name=M2
L=0.35
W='1.143308'
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8_lvt
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8_lvt.sym} -450 -975 0 0 {name=M3
L=0.35
W='1.143308'
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8_lvt
spiceprefix=X
}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} -1420 -595 0 0 {name=R1
W=0.35
L=817
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} -810 -595 0 0 {name=R2
W=0.35
L=817
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} -940 -595 0 0 {name=R3
W=0.35
L=139.88
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} -430 -695 0 0 {name=R4
W=0.35
L=390.5
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {devices/lab_pin.sym} -430 -775 0 1 {name=l3 lab=vbg}
C {devices/simulator_commands_shown.sym} -160 -1190 0 0 {name=COMMANDS1
simulator=ngspice
only_toplevel=false 
value="
.option savecurrents

.control
  save all
  op
  write refBGR.raw
.endc
"}
C {devices/launcher.sym} 140 -830 0 0 {name=h1
descr="Annotate OP" 
tclcommand="set show_hidden_texts 1; xschem annotate_op"
}
C {devices/code.sym} -1290 -1380 0 0 {name=TT_MODELS
only_toplevel=true
format="tcleval( @value )"
value="
** opencircuitdesign pdks install
.lib $::SKYWATER_MODELS/sky130.lib.spice tt

"
spice_ignore=false}
